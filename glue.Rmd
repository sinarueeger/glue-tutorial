---
title: "Glue numbers and letters in R"
author: "Sina RÃ¼eger"
date: "July 13, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(glue)
```

## Introduction

Sometimes you want to do the following:

### 1. Write analysis results as inline text

```{r echo=FALSE}
n <- 100
dat_study <- as_tibble(data.frame(id = glue("id_{id}", id = sample(100:999, n)), state = sample(c("Uusimaa", "Ostrobothnia", "South Karelia", "Lapland"), n, replace = TRUE))) 
dat_study
```

```{r include=FALSE, tidy=FALSE}
states <- glue_collapse(unique(dat_study$state), sep = ", ", last = " and ")
glue("The study participants were from four different Finnish states: {states}.")
```
The study participants were from four different Finnish states: Ostrobothnia, Uusimaa, South Karelia and Lapland. 



### 2. Create a new column as a function of two (text) columns


```{r echo=FALSE}
dat <- as_tibble(data.frame(chromosome = c(1, 1, 3), position = c(50, 30, 70)) %>% 
  mutate(variant = glue("chr{chromosome}_{position}")))
dat
```


### 3. custom output file path

define a directory at the beginning of a script and store everything there


```{r, eval = FALSE}
## save a plot
ggsave("/data/haemoglobin/experiment-2020-07-13.pdf")

## save data
write_tsv(data, path = "/data/haemoglobin/experiment-2020-07-13.tsv")
```


## Solution: Combining R data objects into strings

`This is some text {NUMBER} and {NUMBER}`

For example:
```
This year,  South of Finland had on average 
{NUMBER_SUN} days of sunshine and {NUMBER_SNOW} of days snowfall
```

results in
```
This year, South of Finland had on average 
50 days of sunshine and 3 of days snowfall
```

## Glue!

```{r, comment = "", tidy = FALSE}
glue("This year,  South of Finland had on average {NUMBER_SUN} 
     days of sunshine and {NUMBER_SNOW} of days snowfall", 
     NUMBER_SUN = 50, NUMBER_SNOW = 3)
```


glue is the tidyverse answer to paste: https://github.com/tidyverse/glue.


## Live coding

```{r}
## install.packages("glue")
library(glue)
library(dplyr)
```


### glue two scalars
```{r}
animals <- "Elephants"
number <- 3
glue("There were {animals}")
```

```{r}
glue("There were {number} {animals}")
```

```{r}
glue("There were {number} {animals}", number = 2, animals = "Giraffe")
```


### Exercise

Tweak the following R command so that it returns: `Yesterdays average temperature was 20.2 celsius.`

```{r}
metric <- "celsius"
temperature <- 20.2
glue("Yesterdays average temperature was [metric] [temperature].")
```

### Collapse vector

Collapse the elements in a vector

```{r}
genes <- c("FTO", "PSCK3", "DTN3", "NRT")
glue_collapse(genes)
glue_collapse(genes, sep = " + ")
```

### Exercise

Predict the output of the following R code and choose solution 1, 2 or 3 below.

```{r}
trees <- c("pine", "fir", "cedar", "spruce", "hemlock")
glue_collapse(trees, sep = ",", last = "and")
```

1. `pine, fir, cedar, spruce and hemlock`
1. `pine,fir,cedar,spruceandhemlock`
1. `pine, fir, cedar, spruceandhemlock`


### Create new column with pipe 

```{r}
starwars %>% select(name, homeworld) %>% mutate(name_homeworld = glue("{name} ({homeworld})"))
```

### Create new vector with pipe

```{r}
vec <- starwars %>% glue_data("{name} ({homeworld})", .na = "unknown")
head(vec)
```

### Exercise

iven the data below, create an extra column id, which is a combination of element and measure, separated with an underscore (e.g. `1_A`)

```{r}
dat <- data.frame(element = c(1, 1, 2, 2), 
                  measure = c("A", "B", "A", "B"))
```

### Combine directory and file name

```{r}
dat <- starwars %>% select(name, homeworld) 
dir <- "/Users/rueger/Projects/" 
filename <- "table_1.txt"

readr::write_tsv(dat, path = glue("{dir}{filename}"))
```


## Find out more

```{r}
apropos("glue")
```

- https://glue.tidyverse.org/index.html
- glue also appears in the [`stringr` cheatsheet](https://raw.githubusercontent.com/rstudio/cheatsheets/master/strings.pdf)
